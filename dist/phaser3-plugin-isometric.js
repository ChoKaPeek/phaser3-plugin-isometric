module.exports=function(t){var i={};function e(s){if(i[s])return i[s].exports;var o=i[s]={i:s,l:!1,exports:{}};return t[s].call(o.exports,o,o.exports,e),o.l=!0,o.exports}return e.m=t,e.c=i,e.d=function(t,i,s){e.o(t,i)||Object.defineProperty(t,i,{enumerable:!0,get:s})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,i){if(1&i&&(t=e(t)),8&i)return t;if(4&i&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(e.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&i&&"string"!=typeof t)for(var o in t)e.d(s,o,function(i){return t[i]}.bind(null,o));return s},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},e.p="/",e(e.s=10)}([function(t,i,e){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var s=function(){function t(t,i){for(var e=0;e<i.length;e++){var s=i[e];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(i,e,s){return e&&t(i.prototype,e),s&&t(i,s),i}}();function o(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}var h=function(){function t(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;o(this,t),this.x=i,this.y=e,this.z=s}return s(t,[{key:"copyFrom",value:function(t){return this.setTo(t.x,t.y,t.z)}},{key:"copyTo",value:function(t){return t.x=this.x,t.y=this.y,t.z=this.z,t}},{key:"equals",value:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}},{key:"set",value:function(t,i,e){this.x=t||0,this.y=i||(0!==i?this.x:0),this.z=e||(void 0===i?this.x:0)}},{key:"setTo",value:function(t,i,e){return this.set(t,i,e)}},{key:"add",value:function(t,i,e){return this.x+=t||0,this.y+=i||0,this.z+=e||0,this}},{key:"subtract",value:function(t,i,e){return this.x-=t||0,this.y-=i||0,this.z-=e||0,this}},{key:"multiply",value:function(t,i,e){return this.x*=t||1,this.y*=i||1,this.z*=e||1,this}},{key:"divide",value:function(t,i,e){return this.x/=t||1,this.y/=i||1,this.z/=e||1,this}}],[{key:"add",value:function(i,e){var s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new t;return s.x=i.x+e.x,s.y=i.y+e.y,s.z=i.z+e.z,s}},{key:"subtract",value:function(i,e){var s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new t;return s.x=i.x-e.x,s.y=i.y-e.y,s.z=i.z-e.z,s}},{key:"multiply",value:function(i,e){var s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new t;return s.x=i.x*e.x,s.y=i.y*e.y,s.z=i.z*e.z,s}},{key:"divide",value:function(i,e){var s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new t;return s.x=i.x/e.x,s.y=i.y/e.y,s.z=i.z/e.z,s}},{key:"equals",value:function(t,i){return t.x===i.x&&t.y===i.y&&t.z===i.z}}]),t}();i.default=h},function(t,i,e){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var s,o=function(){function t(t,i){for(var e=0;e<i.length;e++){var s=i[e];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(i,e,s){return e&&t(i.prototype,e),s&&t(i,s),i}}(),h=e(0),n=(s=h)&&s.__esModule?s:{default:s};function r(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}var a=function(){function t(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;r(this,t),this.x=i,this.y=e,this.z=s,this.widthX=o,this.widthY=h,this.height=a,this._corners=[new n.default(this.x,this.y,this.z),new n.default(this.x,this.y,this.z+this.height),new n.default(this.x,this.y+this.widthY,this.z),new n.default(this.x,this.y+this.widthY,this.z+this.height),new n.default(this.x+this.widthX,this.y,this.z),new n.default(this.x+this.widthX,this.y,this.z+this.height),new n.default(this.x+this.widthX,this.y+this.widthY,this.z),new n.default(this.x+this.widthX,this.y+this.widthY,this.z+this.height)]}return o(t,[{key:"setTo",value:function(t,i,e,s,o,h){return this.x=t,this.y=i,this.z=e,this.widthX=s,this.widthY=o,this.height=h,this}},{key:"copyFrom",value:function(t){this.setTo(t.x,t.y,t.z,t.widthX,t.widthY,t.height)}},{key:"copyTo",value:function(t){return t.x=this.x,t.y=this.y,t.z=this.z,t.widthX=this.widthX,t.widthY=this.widthY,t.height=this.height,t}},{key:"size",value:function(i){return t.size(this,i)}},{key:"contains",value:function(i,e,s){return t.contains(this,i,e,s)}},{key:"containsXY",value:function(i,e){return t.containsXY(this,i,e)}},{key:"clone",value:function(i){return t.clone(this,i)}},{key:"intersects",value:function(i){return t.intersects(this,i)}},{key:"getCorners",value:function(){return this._corners[0].setTo(this.x,this.y,this.z),this._corners[1].setTo(this.x,this.y,this.z+this.height),this._corners[2].setTo(this.x,this.y+this.widthY,this.z),this._corners[3].setTo(this.x,this.y+this.widthY,this.z+this.height),this._corners[4].setTo(this.x+this.widthX,this.y,this.z),this._corners[5].setTo(this.x+this.widthX,this.y,this.z+this.height),this._corners[6].setTo(this.x+this.widthX,this.y+this.widthY,this.z),this._corners[7].setTo(this.x+this.widthX,this.y+this.widthY,this.z+this.height),this._corners}},{key:"toString",value:function(){return"[{Cube (x="+this.x+" y="+this.y+" z="+this.z+" widthX="+this.widthX+" widthY="+this.widthY+" height="+this.height+" empty="+this.empty+")}]"}},{key:"halfWidthX",get:function(){return Math.round(.5*this.widthX)}},{key:"halfWidthY",get:function(){return Math.round(.5*this.widthY)}},{key:"halfHeight",get:function(){return Math.round(.5*this.height)}},{key:"bottom",get:function(){return this.z},set:function(t){t>=this.top?this.height=0:this.height=this.top-t,this.z=t}},{key:"top",get:function(){return this.z+this.height},set:function(t){t<=this.z?this.height=0:this.height=t-this.z}},{key:"backX",get:function(){return this.x},set:function(t){t>=this.frontX?this.widthX=0:this.widthX=this.frontX-t,this.x=t}},{key:"backY",get:function(){return this.y},set:function(t){t>=this.frontY?this.widthY=0:this.widthY=this.frontY-t,this.y=t}},{key:"frontX",get:function(){return this.x+this.widthX},set:function(t){t<=this.x?this.widthX=0:this.widthX=t-this.x}},{key:"frontY",get:function(){return this.y+this.widthY},set:function(t){t<=this.y?this.widthY=0:this.widthY=t-this.y}},{key:"volume",get:function(){return this.widthX*this.widthY*this.height}},{key:"centerX",get:function(){return this.x+this.halfWidthX},set:function(t){this.x=t-this.halfWidthX}},{key:"centerY",get:function(){return this.y+this.halfWidthY},set:function(t){this.y=t-this.halfWidthY}},{key:"centerZ",get:function(){return this.z+this.halfHeight},set:function(t){this.z=t-this.halfHeight}},{key:"randomX",get:function(){return this.x+Math.random()*this.widthX}},{key:"randomY",get:function(){return this.y+Math.random()*this.widthY}},{key:"randomZ",get:function(){return this.z+Math.random()*this.height}},{key:"empty",get:function(){return!this.widthX||!this.widthY||!this.height},set:function(t){!0===t&&this.setTo(0,0,0,0,0,0)}}],[{key:"size",value:function(t,i){return null==i?i=new n.default(t.widthX,t.widthY,t.height):i.setTo(t.widthX,t.widthY,t.height),i}},{key:"clone",value:function(i,e){return null==e?e=new t(i.x,i.y,i.z,i.widthX,i.widthY,i.height):e.setTo(i.x,i.y,i.z,i.widthX,i.widthY,i.height),e}},{key:"contains",value:function(t,i,e,s){return!(t.widthX<=0||t.widthY<=0||t.height<=0)&&(i>=t.x&&i<=t.frontX&&e>=t.y&&e<=t.frontY&&s>=t.z&&s<=t.top)}},{key:"containsXY",value:function(t,i,e){return!(t.widthX<=0||t.widthY<=0)&&(i>=t.x&&i<=t.frontX&&e>=t.y&&e<=t.frontY)}},{key:"containsPoint3",value:function(i,e){return t.contains(i,e.x,e.y,e.z)}},{key:"containsCube",value:function(t,i){return!(t.volume>i.volume)&&(t.x>=i.x&&t.y>=i.y&&t.z>=i.z&&t.frontX<=i.frontX&&t.frontY<=i.frontY&&t.top<=i.top)}},{key:"intersects",value:function(t,i){return!(t.widthX<=0||t.widthY<=0||t.height<=0||i.widthX<=0||i.widthY<=0||i.height<=0)&&!(t.frontX<i.x||t.frontY<i.y||t.x>i.frontX||t.y>i.frontY||t.z>i.top||t.top<i.z)}}]),t}();i.default=a},function(t,i,e){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.ISOSPRITE=void 0;var s=function(){function t(t,i){for(var e=0;e<i.length;e++){var s=i[e];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(i,e,s){return e&&t(i.prototype,e),s&&t(i,s),i}}(),o=n(e(0)),h=n(e(1));function n(t){return t&&t.__esModule?t:{default:t}}var r=i.ISOSPRITE="IsoSprite",a=Phaser.GameObjects.Sprite,l=function(t){function i(t,e,s,h,n,a){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,i);var l=function(t,i){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!i||"object"!=typeof i&&"function"!=typeof i?t:i}(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t,e,s,n,a));return l.type=r,l._isoPosition=new o.default(e,s,h),l.snap=0,l._isoPositionChanged=!0,l._isoBoundsChanged=!0,l._project(),l._isoBounds=l.resetIsoBounds(),l}return function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function, not "+typeof i);t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),i&&(Object.setPrototypeOf?Object.setPrototypeOf(t,i):t.__proto__=i)}(i,t),s(i,[{key:"_project",value:function(){if(this._isoPositionChanged){var t=this.scene.sys.settings.map.isoPlugin,i=this.scene[t].projector.project(this._isoPosition),e=i.x,s=i.y;this.x=e,this.y=s,this.depth=this._isoPosition.x+this._isoPosition.y+1.25*this._isoPosition.z,this.snap>0&&(this.x=Phaser.Math.snapTo(this.x,this.snap),this.y=Phaser.Math.snapTo(this.y,this.snap)),this._isoPositionChanged=this._isoBoundsChanged=!0}}},{key:"preUpdate",value:function(t,i){a.prototype.preUpdate.call(this,t,i),this._project()}},{key:"resetIsoBounds",value:function(){void 0===this._isoBounds&&(this._isoBounds=new h.default);var t=Math.abs(this.scaleX),i=Math.abs(this.scaleY);return this._isoBounds.widthX=Math.round(.5*Math.abs(this.width))*t,this._isoBounds.widthY=Math.round(.5*Math.abs(this.width))*t,this._isoBounds.height=Math.round(Math.abs(this.height)-.5*Math.abs(this.width))*i,this._isoBounds.x=this.isoX+this._isoBounds.widthX*-this.originX+.5*this._isoBounds.widthX,this._isoBounds.y=this.isoY+this._isoBounds.widthY*this.originX-.5*this._isoBounds.widthY,this._isoBounds.z=this.isoZ-Math.abs(this.height)*(1-this.originY)+Math.abs(.5*this.width),this._isoBounds}},{key:"isoX",get:function(){return this._isoPosition.x},set:function(t){this._isoPosition.x=t,this._isoPositionChanged=this._isoBoundsChanged=!0,this.body&&(this.body._reset=!0)}},{key:"isoY",get:function(){return this._isoPosition.y},set:function(t){this._isoPosition.y=t,this._isoPositionChanged=this._isoBoundsChanged=!0,this.body&&(this.body._reset=!0)}},{key:"isoZ",get:function(){return this._isoPosition.z},set:function(t){this._isoPosition.z=t,this._isoPositionChanged=this._isoBoundsChanged=!0,this.body&&(this.body._reset=!0)}},{key:"isoPosition",get:function(){return this._isoPosition}},{key:"isoBounds",get:function(){return!this._isoBoundsChanged&&this._isoBounds||(this.resetIsoBounds(),this._isoBoundsChanged=!1),this._isoBounds}}]),i}(a);i.default=l},function(t,i,e){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.MILITARY=i.ISOMETRIC=i.CLASSIC=void 0;var s,o=function(){function t(t,i){for(var e=0;e<i.length;e++){var s=i[e];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(i,e,s){return e&&t(i.prototype,e),s&&t(i,s),i}}(),h=e(0),n=(s=h)&&s.__esModule?s:{default:s};var r=Phaser.Geom.Point,a=i.CLASSIC=Math.atan(.5),l=(i.ISOMETRIC=Math.PI/6,i.MILITARY=Math.PI/4,function(){function t(i,e){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,t),this.scene=i,this._transform=null,this._projectionAngle=0,this.projectionAngle=e||a,this.origin=new r(.5,.5)}return o(t,[{key:"project",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new r;i.x=(t.x-t.y)*this._transform[0],i.y=(t.x+t.y)*this._transform[1]-t.z;var e=this.scene.sys.game.config,s=e.width,o=e.height;return i.x+=s*this.origin.x,i.y+=o*this.origin.y,i}},{key:"projectXY",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new r;i.x=(t.x-t.y)*this._transform[0],i.y=(t.x+t.y)*this._transform[1];var e=this.scene.sys.game.config,s=e.width,o=e.height;return i.x+=s*this.origin.x,i.y+=o*this.origin.y,i}},{key:"unproject",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new n.default,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=this.scene.sys.game.config,o=s.width,h=s.height,r=t.x-this.scene.cameras.main.x-o*this.origin.x+this.scene.cameras.main.scrollX,a=t.y-this.scene.cameras.main.y-h*this.origin.y+e+this.scene.cameras.main.scrollY;return i.x=r/(2*this._transform[0])+a/(2*this._transform[1]),i.y=-r/(2*this._transform[0])+a/(2*this._transform[1]),i.z=e,i}},{key:"projectionAngle",set:function(t){t!==this._projectionAngle&&(this._projectionAngle=t,this._transform=[Math.cos(this._projectionAngle),Math.sin(this._projectionAngle)])},get:function(){return this._projectionAngle}}]),t}());i.default=l},function(t,i,e){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.ISOPARTICLEEMITTERMANAGER=void 0;var s,o=function(){function t(t,i){for(var e=0;e<i.length;e++){var s=i[e];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(i,e,s){return e&&t(i.prototype,e),s&&t(i,s),i}}(),h=e(5),n=(s=h)&&s.__esModule?s:{default:s};var r=i.ISOPARTICLEEMITTERMANAGER="IsoParticleEmitterManager",a=Phaser.GameObjects.Particles.ParticleEmitterManager,l=Phaser.Utils.Objects.GetFastValue,u=function(t){function i(t,e,s,o){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,i);var h=function(t,i){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!i||"object"!=typeof i&&"function"!=typeof i?t:i}(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t,e,s,[]));h.type=r;for(var n=0;n<o.length;++n)h.createEmitter(o[n]);return h}return function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function, not "+typeof i);t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),i&&(Object.setPrototypeOf?Object.setPrototypeOf(t,i):t.__proto__=i)}(i,t),o(i,[{key:"createEmitter",value:function(t){if(void 0!==t&&"iso"===l(t,"type","random"))return this.addEmitter(new n.default(this,t));return a.prototype.createEmitter.call(this,t)}},{key:"preUpdate",value:function(t,i){a.prototype.preUpdate.call(this,t,i)}}]),i}(a);i.default=u},function(t,i,e){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.ISOPARTICLEEMITTER=void 0;var s,o=function(){function t(t,i){for(var e=0;e<i.length;e++){var s=i[e];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(i,e,s){return e&&t(i.prototype,e),s&&t(i,s),i}}(),h=e(6),n=(s=h)&&s.__esModule?s:{default:s};var r=i.ISOPARTICLEEMITTER="IsoParticleEmitter",a=Phaser.GameObjects.Particles.ParticleEmitter,l=Phaser.Utils.Objects.HasValue,u=Phaser.Utils.Objects.GetFastValue,c=function(t){function i(t,e){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,i);var s=void 0;l(e,"emitZone")&&(s=e.emitZone,delete e.emitZone);var o=function(t,i){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!i||"object"!=typeof i&&"function"!=typeof i?t:i}(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t,e));return o.type=r,o._setIsoEmitZone(s),o}return function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function, not "+typeof i);t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),i&&(Object.setPrototypeOf?Object.setPrototypeOf(t,i):t.__proto__=i)}(i,t),o(i,[{key:"_setIsoEmitZone",value:function(t){if(void 0!==t){if("iso"===u(t,"type","random")){var i=u(t,"z",null),e=u(t,"source",null),s=u(t,"quantity",1),o=u(t,"stepRate",0),h=u(t,"yoyo",!1),r=u(t,"seamless",!0);this.emitZone=new n.default(i,e,s,o,h,r)}}else this.emitZone=null}},{key:"preUpdate",value:function(t,i){a.prototype.preUpdate.call(this,t,i)}}]),i}(a);i.default=c},function(t,i,e){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var s,o=function(){function t(t,i){for(var e=0;e<i.length;e++){var s=i[e];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(i,e,s){return e&&t(i.prototype,e),s&&t(i,s),i}}(),h=e(0),n=(s=h)&&s.__esModule?s:{default:s};var r=function(t){function i(t,e,s,o,h,n){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,i);for(var r=function(t,i){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!i||"object"!=typeof i&&"function"!=typeof i?t:i}(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,e,s,o,h,n)),a=0;a<r.points.length;++a)r._project(r.points[a],t);return r}return function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function, not "+typeof i);t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),i&&(Object.setPrototypeOf?Object.setPrototypeOf(t,i):t.__proto__=i)}(i,t),o(i,[{key:"_project",value:function(t,i){var e=new n.default(t.x,t.y,i),s=this.scene.sys.settings.map.isoPlugin,o=this.scene[s].projector.project(e),h=o.x,r=o.y;t.x=h,t.y=r,t.depth=e.x+e.y+1.25*e.z}}]),i}(Phaser.GameObjects.Particles.Zones.EdgeZone);i.default=r},function(t,i,e){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var s,o=function(){function t(t,i){for(var e=0;e<i.length;e++){var s=i[e];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(i,e,s){return e&&t(i.prototype,e),s&&t(i,s),i}}(),h=e(1),n=(s=h)&&s.__esModule?s:{default:s};var r=function(){function t(i,e,s,o,h,n,r,a,l){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,t),this.maxObjects=10,this.maxLevels=4,this.level=0,this.bounds={},this.objects=[],this.nodes=[],this._empty=[],this.reset(i,e,s,o,h,n,r,a,l)}return o(t,[{key:"reset",value:function(t,i,e,s,o,h,n,r,a){this.maxObjects=n||10,this.maxLevels=r||4,this.level=a||0,this.bounds={x:Math.round(t),y:Math.round(i),z:Math.round(e),widthX:s,widthY:o,height:h,subWidthX:Math.floor(.5*s),subWidthY:Math.floor(.5*o),subHeight:Math.floor(.5*h),frontX:Math.round(t)+Math.floor(.5*s),frontY:Math.round(i)+Math.floor(.5*o),top:Math.round(e)+Math.floor(.5*h)},this.objects.length=0,this.nodes.length=0}},{key:"populate",value:function(t){for(var i=t.children.size,e=t.children.entries,s=0;s<i;s++)this.populateHandler(e[s])}},{key:"populateHandler",value:function(t){t.body&&this.insert(t.body)}},{key:"split",value:function(){this.nodes[0]=new t(this.bounds.x,this.bounds.y,this.bounds.z,this.bounds.subWidthX,this.bounds.subWidthY,this.bounds.subHeight,this.maxLevels,this.level+1),this.nodes[1]=new t(this.bounds.frontX,this.bounds.y,this.bounds.z,this.bounds.subWidthX,this.bounds.subWidthY,this.bounds.subHeight,this.maxLevels,this.level+1),this.nodes[2]=new t(this.bounds.x,this.bounds.frontY,this.bounds.z,this.bounds.subWidthX,this.bounds.subWidthY,this.bounds.subHeight,this.maxLevels,this.level+1),this.nodes[3]=new t(this.bounds.frontX,this.bounds.frontY,this.bounds.z,this.bounds.subWidthX,this.bounds.subWidthY,this.bounds.subHeight,this.maxLevels,this.level+1),this.nodes[4]=new t(this.bounds.x,this.bounds.y,this.bounds.top,this.bounds.subWidthX,this.bounds.subWidthY,this.bounds.subHeight,this.maxLevels,this.level+1),this.nodes[5]=new t(this.bounds.frontX,this.bounds.y,this.bounds.top,this.bounds.subWidthX,this.bounds.subWidthY,this.bounds.subHeight,this.maxLevels,this.level+1),this.nodes[6]=new t(this.bounds.x,this.bounds.frontY,this.bounds.top,this.bounds.subWidthX,this.bounds.subWidthY,this.bounds.subHeight,this.maxLevels,this.level+1),this.nodes[7]=new t(this.bounds.frontX,this.bounds.frontY,this.bounds.top,this.bounds.subWidthX,this.bounds.subWidthY,this.bounds.subHeight,this.maxLevels,this.level+1)}},{key:"insert",value:function(t){var i,e=0;if(null==this.nodes[0]||-1===(i=this.getIndex(t))){if(this.objects.push(t),this.objects.length>this.maxObjects&&this.level<this.maxLevels)for(null==this.nodes[0]&&this.split();e<this.objects.length;)-1!==(i=this.getIndex(this.objects[e]))?this.nodes[i].insert(this.objects.splice(e,1)[0]):e++}else this.nodes[i].insert(t)}},{key:"getIndex",value:function(t){var i=-1;return t.x<this.bounds.frontX&&t.frontX<this.bounds.frontX?t.y<this.bounds.frontY&&t.frontY<this.bounds.frontY?t.z<this.bounds.top&&t.top<this.bounds.top?i=0:t.z>this.bounds.top&&(i=4):t.y>this.bounds.frontY&&(t.z<this.bounds.top&&t.top<this.bounds.top?i=2:t.z>this.bounds.top&&(i=6)):t.x>this.bounds.frontX&&(t.y<this.bounds.frontY&&t.frontY<this.bounds.frontY?t.z<this.bounds.top&&t.top<this.bounds.top?i=1:t.z>this.bounds.top&&(i=5):t.y>this.bounds.frontY&&(t.z<this.bounds.top&&t.top<this.bounds.top?i=3:t.z>this.bounds.top&&(i=7))),i}},{key:"retrieve",value:function(t){var i,e;if(t instanceof n.default)i=this.objects,e=this.getIndex(t);else{if(!t.body)return this._empty;i=this.objects,e=this.getIndex(t.body)}return this.nodes[0]&&(i=-1!==e?i.concat(this.nodes[e].retrieve(t)):(i=(i=(i=(i=(i=(i=(i=i.concat(this.nodes[0].retrieve(t))).concat(this.nodes[1].retrieve(t))).concat(this.nodes[2].retrieve(t))).concat(this.nodes[3].retrieve(t))).concat(this.nodes[4].retrieve(t))).concat(this.nodes[5].retrieve(t))).concat(this.nodes[6].retrieve(t))).concat(this.nodes[7].retrieve(t))),i}},{key:"clear",value:function(){this.objects.length=0;for(var t=this.nodes.length;t--;)this.nodes[t].clear(),this.nodes.splice(t,1);this.nodes.length=0}}]),t}();i.default=r},function(t,i,e){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.TYPE=void 0;var s=function(){function t(t,i){for(var e=0;e<i.length;e++){var s=i[e];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(i,e,s){return e&&t(i.prototype,e),s&&t(i,s),i}}(),o=n(e(0)),h=n(e(1));function n(t){return t&&t.__esModule?t:{default:t}}var r=i.TYPE="IsoPhysics",a=function(){function t(i){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,t),this.sprite=i,this.scene=i.scene,this.type=r,this.enable=!0,this.offset=new o.default,this.position=new o.default(i.isoX,i.isoY,i.isoZ),this.prev=new o.default(this.position.x,this.position.y,this.position.z),this.allowRotation=!0,this.rotation=i.rotation,this.preRotation=i.rotation,this.sourceWidthX=i.width/i.scaleX,this.sourceWidthY=i.width/i.scaleX,this.sourceHeight=i.height/i.scaleY,this.widthX=Math.ceil(.5*i.width),this.widthY=Math.ceil(.5*i.width),this.height=i.height-Math.ceil(.5*i.width),this.halfWidthX=Math.abs(.5*this.widthX),this.halfWidthY=Math.abs(.5*this.widthY),this.halfHeight=Math.abs(.5*this.height),this.center=new o.default(i.isoX+this.halfWidthX,i.isoY+this.halfWidthY,i.isoZ+this.halfHeight),this.velocity=new o.default,this.newVelocity=new o.default,this.deltaMax=new o.default,this.acceleration=new o.default,this.drag=new o.default,this.allowGravity=!0,this.gravity=new o.default,this.bounce=new o.default,this.maxVelocity=new o.default(1e4,1e4,1e4),this.angularVelocity=0,this.angularAcceleration=0,this.angularDrag=0,this.maxAngular=1e3,this.mass=1,this.angle=0,this.speed=0,this.facing=Phaser.NONE,this.immovable=!1,this.moves=!0,this.customSeparateX=!1,this.customSeparateY=!1,this.customSeparateZ=!1,this.overlapX=0,this.overlapY=0,this.overlapZ=0,this.embedded=!1,this.collideWorldBounds=!1,this.checkCollision={none:!1,any:!0,up:!0,down:!0,frontX:!0,frontY:!0,backX:!0,backY:!0},this.touching={none:!0,up:!1,down:!1,frontX:!1,frontY:!1,backX:!1,backY:!1},this.wasTouching={none:!0,up:!1,down:!1,frontX:!1,frontY:!1,backX:!1,backY:!1},this.blocked={up:!1,down:!1,frontX:!1,frontY:!1,backX:!1,backY:!1},this.phase=0,this.skipTree=!1,this._reset=!0,this._sx=i.scaleX,this._sy=i.scaleY,this._dx=0,this._dy=0,this._dz=0,this._corners=[new o.default(this.x,this.y,this.z),new o.default(this.x,this.y,this.z+this.height),new o.default(this.x,this.y+this.widthY,this.z),new o.default(this.x,this.y+this.widthY,this.z+this.height),new o.default(this.x+this.widthX,this.y,this.z),new o.default(this.x+this.widthX,this.y,this.z+this.height),new o.default(this.x+this.widthX,this.y+this.widthY,this.z),new o.default(this.x+this.widthX,this.y+this.widthY,this.z+this.height)]}return s(t,[{key:"updateBounds",value:function(){var t=Math.abs(this.sprite.scaleX),i=Math.abs(this.sprite.scaleY);t===this._sx&&i===this._sy||(this.widthX=Math.ceil(.5*this.sprite.width),this.widthY=Math.ceil(.5*this.sprite.width),this.height=Math.ceil(this.sprite.height-.5*this.sprite.width),this.halfWidthX=Math.floor(.5*this.widthX),this.halfWidthY=Math.floor(.5*this.widthY),this.halfHeight=Math.floor(.5*this.height),this._sx=t,this._sy=i,this.center.setTo(this.position.x+this.halfWidthX,this.position.y+this.halfWidthY,this.position.z+this.halfHeight),this._reset=!0)}},{key:"update",value:function(t,i){if(this.enable){if(this.phase=1,this.wasTouching.none=this.touching.none,this.wasTouching.up=this.touching.up,this.wasTouching.down=this.touching.down,this.wasTouching.backX=this.touching.backX,this.wasTouching.backY=this.touching.backY,this.wasTouching.frontX=this.touching.frontX,this.wasTouching.frontY=this.touching.frontY,this.touching.none=!0,this.touching.up=!1,this.touching.down=!1,this.touching.backX=!1,this.touching.backY=!1,this.touching.frontX=!1,this.touching.frontY=!1,this.blocked.up=!1,this.blocked.down=!1,this.blocked.frontY=!1,this.blocked.frontX=!1,this.blocked.backY=!1,this.blocked.backX=!1,this.embedded=!1,this.updateBounds(),this.position.x=this.sprite.isoX+(this.widthX*-this.sprite.originX+.5*this.widthX)+this.offset.x,this.position.y=this.sprite.isoY+(this.widthY*this.sprite.originX-.5*this.widthY)+this.offset.y,this.position.z=this.sprite.isoZ-Math.abs(this.sprite.height)*(1-this.sprite.originY)+Math.abs(.5*this.sprite.width)+this.offset.z,this.rotation=this.sprite.angle,this.preRotation=this.rotation,(this._reset||!0===this.sprite.fresh)&&(this.prev.x=this.position.x,this.prev.y=this.position.y,this.prev.z=this.position.z),this.moves){var e=this.scene.sys.settings.map.isoPhysics,s=this.scene[e].world;i/=1e3,s.updateMotion(this,i),this.newVelocity.set(this.velocity.x*i,this.velocity.y*i,this.velocity.z*i),this.position.x+=this.newVelocity.x,this.position.y+=this.newVelocity.y,this.position.z+=this.newVelocity.z,this.position.x===this.prev.x&&this.position.y===this.prev.y&&this.position.z===this.prev.z||(this.speed=Math.sqrt(this.velocity.x*this.velocity.x+this.velocity.y*this.velocity.y+this.velocity.z*this.velocity.z),this.angle=Math.atan2(this.velocity.y,this.velocity.x)),this.collideWorldBounds&&this.checkWorldBounds(),this.sprite.outOfBoundsKill&&!s.bounds.intersects(this.sprite.isoBounds)&&this.sprite.kill()}this._dx=this.deltaX(),this._dy=this.deltaY(),this._dz=this.deltaZ(),this._reset=!1}}},{key:"postUpdate",value:function(){this.enable&&2!==this.phase&&(this.phase=2,this._reset&&(this.prev.x=this.position.x,this.prev.y=this.position.y,this.prev.z=this.position.z),this.deltaAbsX()>=this.deltaAbsY()&&this.deltaAbsX()>=this.deltaAbsZ()?this.deltaX()<0?this.facing=4:this.deltaX()>0&&(this.facing=2):this.deltaAbsY()>=this.deltaAbsX()&&this.deltaAbsY()>=this.deltaAbsZ()?this.deltaY()<0?this.facing=5:this.deltaY()>0&&(this.facing=3):this.deltaZ()<0?this.facing=1:this.deltaZ()>0&&(this.facing=0),this.moves&&(this._dx=this.deltaX(),this._dy=this.deltaY(),this._dz=this.deltaZ(),0!==this.deltaMax.x&&0!==this._dx&&(this._dx<0&&this._dx<-this.deltaMax.x?this._dx=-this.deltaMax.x:this._dx>0&&this._dx>this.deltaMax.x&&(this._dx=this.deltaMax.x)),0!==this.deltaMax.y&&0!==this._dy&&(this._dy<0&&this._dy<-this.deltaMax.y?this._dy=-this.deltaMax.y:this._dy>0&&this._dy>this.deltaMax.y&&(this._dy=this.deltaMax.y)),0!==this.deltaMax.z&&0!==this._dz&&(this._dz<0&&this._dz<-this.deltaMax.z?this._dz=-this.deltaMax.z:this._dz>0&&this._dz>this.deltaMax.z&&(this._dz=this.deltaMax.z)),this.sprite.isoX+=this._dx,this.sprite.isoY+=this._dy,this.sprite.isoZ+=this._dz),this.center.setTo(this.position.x+this.halfWidthX,this.position.y+this.halfWidthY,this.position.z+this.halfHeight),this.allowRotation&&(this.sprite.angle+=this.deltaR()),this.prev.x=this.position.x,this.prev.y=this.position.y,this.prev.z=this.position.z,this._reset=!1)}},{key:"destroy",value:function(){this.sprite=null}},{key:"checkWorldBounds",value:function(){var t=this.scene.sys.settings.map.isoPhysics,i=this.scene[t].world;this.position.x<i.bounds.x&&i.checkCollision.backX?(this.position.x=i.bounds.x,this.velocity.x*=-this.bounce.x,this.blocked.backX=!0):this.frontX>i.bounds.frontX&&i.checkCollision.frontX&&(this.position.x=i.bounds.frontX-this.widthX,this.velocity.x*=-this.bounce.x,this.blocked.frontX=!0),this.position.y<i.bounds.y&&i.checkCollision.backY?(this.position.y=i.bounds.y,this.velocity.y*=-this.bounce.y,this.blocked.backY=!0):this.frontY>i.bounds.frontY&&i.checkCollision.frontY&&(this.position.y=i.bounds.frontY-this.widthY,this.velocity.y*=-this.bounce.y,this.blocked.frontY=!0),this.position.z<i.bounds.z&&i.checkCollision.down?(this.position.z=i.bounds.z,this.velocity.z*=-this.bounce.z,this.blocked.down=!0):this.top>i.bounds.top&&i.checkCollision.up&&(this.position.z=i.bounds.top-this.height,this.velocity.z*=-this.bounce.z,this.blocked.up=!0)}},{key:"setSize",value:function(t,i,e,s,o,h){void 0===s&&(s=this.offset.x),void 0===o&&(o=this.offset.y),void 0===h&&(h=this.offset.z),this.sourceWidthX=t,this.sourceWidthY=i,this.sourceHeight=e,this.widthX=this.sourceWidthX*this._sx,this.widthY=this.sourceWidthY*this._sx,this.height=this.sourceHeight*this._sy,this.halfWidthX=Math.floor(.5*this.widthX),this.halfWidthY=Math.floor(.5*this.widthY),this.halfHeight=Math.floor(.5*this.height),this.offset.setTo(s,o,h),this.center.setTo(this.position.x+this.halfWidthX,this.position.y+this.halfWidthY,this.position.z+this.halfHeight)}},{key:"reset",value:function(t,i,e){this.velocity.set(0),this.acceleration.set(0),this.angularVelocity=0,this.angularAcceleration=0,this.position.x=t+(this.widthX*-this.sprite.anchor.x+.5*this.widthX)+this.offset.x,this.position.y=i+(this.widthY*this.sprite.anchor.x-.5*this.widthY)+this.offset.y,this.position.z=e-Math.abs(this.sprite.height)*(1-this.sprite.anchor.y)+Math.abs(.5*this.sprite.width)+this.offset.z,this.prev.x=this.position.x,this.prev.y=this.position.y,this.prev.z=this.position.z,this.rotation=this.sprite.angle,this.preRotation=this.rotation,this._sx=this.sprite.scaleX,this._sy=this.sprite.scaleY,this.center.setTo(this.position.x+this.halfWidthX,this.position.y+this.halfWidthY,this.position.z+this.halfHeight),this.sprite._isoPositionChanged=!0}},{key:"hitTest",value:function(t,i,e){return h.default.contains(this,t,i,e)}},{key:"onFloor",value:function(){return this.blocked.down}},{key:"onWall",value:function(){return this.blocked.frontX||this.blocked.frontY||this.blocked.backX||this.blocked.backY}},{key:"deltaAbsX",value:function(){return this.deltaX()>0?this.deltaX():-this.deltaX()}},{key:"deltaAbsY",value:function(){return this.deltaY()>0?this.deltaY():-this.deltaY()}},{key:"deltaAbsZ",value:function(){return this.deltaZ()>0?this.deltaZ():-this.deltaZ()}},{key:"deltaX",value:function(){return this.position.x-this.prev.x}},{key:"deltaY",value:function(){return this.position.y-this.prev.y}},{key:"deltaZ",value:function(){return this.position.z-this.prev.z}},{key:"deltaR",value:function(){return this.rotation-this.preRotation}},{key:"getCorners",value:function(){return this._corners[0].setTo(this.x,this.y,this.z),this._corners[1].setTo(this.x,this.y,this.z+this.height),this._corners[2].setTo(this.x,this.y+this.widthY,this.z),this._corners[3].setTo(this.x,this.y+this.widthY,this.z+this.height),this._corners[4].setTo(this.x+this.widthX,this.y,this.z),this._corners[5].setTo(this.x+this.widthX,this.y,this.z+this.height),this._corners[6].setTo(this.x+this.widthX,this.y+this.widthY,this.z),this._corners[7].setTo(this.x+this.widthX,this.y+this.widthY,this.z+this.height),this._corners}},{key:"debugRender",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"rgba(0,255,0,0.4)",e=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],s=[],o=this.getCorners(),h=-this.scene.cameras.main.x,n=-this.scene.cameras.main.y,r=this.scene.sys.settings.map.isoPlugin,a=this.scene[r].projector;if(e){s=(s=[o[1],o[3],o[2],o[6],o[4],o[5],o[1]]).map((function(t){var i=a.project(t);return i.x+=h,i.y+=n,i})),t.beginPath(),t.fillStyle=i,t.moveTo(s[0].x,s[0].y);for(var l=1;l<s.length;l++)t.lineTo(s[l].x,s[l].y);t.fill()}else s=(s=o.slice(0,o.length)).map((function(t){var i=a.project(t);return i.x+=h,i.y+=n,i})),t.moveTo(s[0].x,s[0].y),t.beginPath(),t.strokeStyle=i,t.lineTo(s[1].x,s[1].y),t.lineTo(s[3].x,s[3].y),t.lineTo(s[2].x,s[2].y),t.lineTo(s[6].x,s[6].y),t.lineTo(s[4].x,s[4].y),t.lineTo(s[5].x,s[5].y),t.lineTo(s[1].x,s[1].y),t.lineTo(s[0].x,s[0].y),t.lineTo(s[4].x,s[4].y),t.moveTo(s[0].x,s[0].y),t.lineTo(s[2].x,s[2].y),t.moveTo(s[3].x,s[3].y),t.lineTo(s[7].x,s[7].y),t.lineTo(s[6].x,s[6].y),t.moveTo(s[7].x,s[7].y),t.lineTo(s[5].x,s[5].y),t.stroke(),t.closePath()}},{key:"top",get:function(){return this.position.z+this.height}},{key:"frontX",get:function(){return this.position.x+this.widthX}},{key:"right",get:function(){return this.position.x+this.widthX}},{key:"frontY",get:function(){return this.position.y+this.widthY}},{key:"bottom",get:function(){return this.position.y+this.widthY}},{key:"x",get:function(){return this.position.x},set:function(t){this.position.x=t}},{key:"y",get:function(){return this.position.y},set:function(t){this.position.y=t}},{key:"z",get:function(){return this.position.z},set:function(t){this.position.z=t}}]),t}();i.default=a},function(t,i,e){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var s=function(){function t(t,i){for(var e=0;e<i.length;e++){var s=i[e];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(i,e,s){return e&&t(i.prototype,e),s&&t(i,s),i}}(),o=l(e(8)),h=l(e(0)),n=l(e(1)),r=l(e(7)),a=e(2);function l(t){return t&&t.__esModule?t:{default:t}}var u=Phaser,c=u.GameObjects,d=u.Structs,y=function(){function t(i){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,t),this.bodies=new d.Set;var e=i.sys.game.config,s=e.width,o=e.height;this.bounds=new n.default(0,0,0,.5*s,.5*s,o),this.gravity=new h.default,this.checkCollision={up:!0,down:!0,frontX:!0,frontY:!0,backX:!0,backY:!0},this.OVERLAP_BIAS=4,this.forceXY=!1,this.skipTree=!1,this.maxObjects=10,this.maxLevels=4,this.octree=new r.default(this.bounds.x,this.bounds.y,this.bounds.z,this.bounds.widthX,this.bounds.widthY,this.bounds.height,this.maxObjects,this.maxLevels),this._overlap=0,this._maxOverlap=0,this._velocity1=0,this._velocity2=0,this._newVelocity1=0,this._newVelocity2=0,this._average=0,this._mapData=[],this._result=!1,this._total=0,this._angle=0,this._dx=0,this._dy=0,this._dz=0}return s(t,[{key:"enable",value:function(t){var i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],e=1;if(Array.isArray(t))for(e=t.length;e--;)t[e]instanceof c.Group?this.enable(t[e].children,i):(this.enableBody(t[e]),i&&t[e].hasOwnProperty("children")&&t[e].children.length>0&&this.enable(t[e],!0));else t instanceof c.Group?this.enable(t.children,i):(this.enableBody(t),i&&t.hasOwnProperty("children")&&t.children.length>0&&this.enable(t.children,!0))}},{key:"enableBody",value:function(t){return null===t.body&&(t.body=new o.default(t),this.bodies.set(t.body)),t}},{key:"setBounds",value:function(t,i,e,s,o,h){this.bounds.setTo(t,i,e,s,o,h)}},{key:"setBoundsToWorld",value:function(){var t=this.scene.sys.game.config,i=t.width,e=t.height;this.bounds.setTo(0,0,0,.5*i,.5*i,e)}},{key:"computeVelocity",value:function(t,i,e,s,o,h,n){return h=h||1e4,1===t&&i.allowGravity?e+=(this.gravity.x+i.gravity.x)*n:2===t&&i.allowGravity?e+=(this.gravity.y+i.gravity.y)*n:3===t&&i.allowGravity&&(e+=(this.gravity.z+i.gravity.z)*n),s?e+=s*n:o&&(this._drag=o*n,e-this._drag>0?e-=this._drag:e+this._drag<0?e+=this._drag:e=0),e>h?e=h:e<-h&&(e=-h),e}},{key:"separate",value:function(t,i,e,s,o){return!!(t.enable&&i.enable&&this.intersects(t,i))&&((!e||!1!==e.call(s,t.sprite,i.sprite))&&(!!o||(this.forceXY||Math.abs(this.gravity.z+t.gravity.z)<Math.abs(this.gravity.x+t.gravity.x)||Math.abs(this.gravity.z+t.gravity.z)<Math.abs(this.gravity.y+t.gravity.y)?this._result=this.separateX(t,i,o)||this.separateY(t,i,o)||this.separateZ(t,i,o):this._result=this.separateZ(t,i,o)||this.separateX(t,i,o)||this.separateY(t,i,o),this._result)))}},{key:"intersects",value:function(t,i){return!(t.frontX<=i.x)&&(!(t.frontY<=i.y)&&(!(t.x>=i.frontX)&&(!(t.y>=i.frontY)&&(!(t.top<=i.z)&&!(t.z>=i.top)))))}},{key:"separateX",value:function(t,i,e){return(!t.immovable||!i.immovable)&&(this._overlap=0,this._maxOverlap=t.deltaAbsX()+i.deltaAbsX()+this.OVERLAP_BIAS,0===t.deltaX()&&0===i.deltaX()?(t.embedded=!0,i.embedded=!0):t.deltaX()>i.deltaX()?(this._overlap=t.frontX-i.x,this._overlap>this._maxOverlap||!1===t.checkCollision.frontX||!1===i.checkCollision.backX?this._overlap=0:(t.touching.none=!1,t.touching.frontX=!0,i.touching.none=!1,i.touching.backX=!0)):t.deltaX()<i.deltaX()&&(this._overlap=t.x-i.widthX-i.x,-this._overlap>this._maxOverlap||!1===t.checkCollision.backX||!1===i.checkCollision.frontX?this._overlap=0:(t.touching.none=!1,t.touching.backX=!0,i.touching.none=!1,i.touching.frontX=!0)),0!==this._overlap&&(t.overlapX=this._overlap,i.overlapX=this._overlap,e||t.customSeparateX||i.customSeparateX||(this._velocity1=t.velocity.x,this._velocity2=i.velocity.x,t.immovable||i.immovable?t.immovable?i.immovable||(i.x+=this._overlap,i.velocity.x=this._velocity1-this._velocity2*i.bounce.x):(t.x=t.x-this._overlap,t.velocity.x=this._velocity2-this._velocity1*t.bounce.x):(this._overlap*=.5,t.x=t.x-this._overlap,i.x+=this._overlap,this._newVelocity1=Math.sqrt(this._velocity2*this._velocity2*i.mass/t.mass)*(this._velocity2>0?1:-1),this._newVelocity2=Math.sqrt(this._velocity1*this._velocity1*t.mass/i.mass)*(this._velocity1>0?1:-1),this._average=.5*(this._newVelocity1+this._newVelocity2),this._newVelocity1-=this._average,this._newVelocity2-=this._average,t.velocity.x=this._average+this._newVelocity1*t.bounce.x,i.velocity.x=this._average+this._newVelocity2*i.bounce.x)),!0))}},{key:"separateY",value:function(t,i,e){return(!t.immovable||!i.immovable)&&(this._overlap=0,this._maxOverlap=t.deltaAbsY()+i.deltaAbsY()+this.OVERLAP_BIAS,0===t.deltaY()&&0===i.deltaY()?(t.embedded=!0,i.embedded=!0):t.deltaY()>i.deltaY()?(this._overlap=t.frontY-i.y,this._overlap>this._maxOverlap||!1===t.checkCollision.frontY||!1===i.checkCollision.backY?this._overlap=0:(t.touching.none=!1,t.touching.frontY=!0,i.touching.none=!1,i.touching.backY=!0)):t.deltaY()<i.deltaY()&&(this._overlap=t.y-i.widthY-i.y,-this._overlap>this._maxOverlap||!1===t.checkCollision.backY||!1===i.checkCollision.frontY?this._overlap=0:(t.touching.none=!1,t.touching.backY=!0,i.touching.none=!1,i.touching.frontY=!0)),0!==this._overlap&&(t.overlapY=this._overlap,i.overlapY=this._overlap,e||t.customSeparateY||i.customSeparateY||(this._velocity1=t.velocity.y,this._velocity2=i.velocity.y,t.immovable||i.immovable?t.immovable?i.immovable||(i.y+=this._overlap,i.velocity.y=this._velocity1-this._velocity2*i.bounce.y):(t.y=t.y-this._overlap,t.velocity.y=this._velocity2-this._velocity1*t.bounce.y):(this._overlap*=.5,t.y=t.y-this._overlap,i.y+=this._overlap,this._newVelocity1=Math.sqrt(this._velocity2*this._velocity2*i.mass/t.mass)*(this._velocity2>0?1:-1),this._newVelocity2=Math.sqrt(this._velocity1*this._velocity1*t.mass/i.mass)*(this._velocity1>0?1:-1),this._average=.5*(this._newVelocity1+this._newVelocity2),this._newVelocity1-=this._average,this._newVelocity2-=this._average,t.velocity.y=this._average+this._newVelocity1*t.bounce.y,i.velocity.y=this._average+this._newVelocity2*i.bounce.y)),!0))}},{key:"separateZ",value:function(t,i,e){return(!t.immovable||!i.immovable)&&(this._overlap=0,this._maxOverlap=t.deltaAbsZ()+i.deltaAbsZ()+this.OVERLAP_BIAS,0===t.deltaZ()&&0===i.deltaZ()?(t.embedded=!0,i.embedded=!0):t.deltaZ()>i.deltaZ()?(this._overlap=t.top-i.z,this._overlap>this._maxOverlap||!1===t.checkCollision.down||!1===i.checkCollision.up?this._overlap=0:(t.touching.none=!1,t.touching.down=!0,i.touching.none=!1,i.touching.up=!0)):t.deltaZ()<i.deltaZ()&&(this._overlap=t.z-i.top,-this._overlap>this._maxOverlap||!1===t.checkCollision.up||!1===i.checkCollision.down?this._overlap=0:(t.touching.none=!1,t.touching.up=!0,i.touching.none=!1,i.touching.down=!0)),0!==this._overlap&&(t.overlapZ=this._overlap,i.overlapZ=this._overlap,e||t.customSeparateY||i.customSeparateZ||(this._velocity1=t.velocity.z,this._velocity2=i.velocity.z,t.immovable||i.immovable?t.immovable?i.immovable||(i.z+=this._overlap,i.velocity.z=this._velocity1-this._velocity2*i.bounce.z,t.moves&&(i.x+=t.x-t.prev.x,i.y+=t.y-t.prev.y)):(t.z=t.z-this._overlap,t.velocity.z=this._velocity2-this._velocity1*t.bounce.z,i.moves&&(t.x+=i.x-i.prev.x,t.y+=i.y-i.prev.y)):(this._overlap*=.5,t.z=t.z-this._overlap,i.z+=this._overlap,this._newVelocity1=Math.sqrt(this._velocity2*this._velocity2*i.mass/t.mass)*(this._velocity2>0?1:-1),this._newVelocity2=Math.sqrt(this._velocity1*this._velocity1*t.mass/i.mass)*(this._velocity1>0?1:-1),this._average=.5*(this._newVelocity1+this._newVelocity2),this._newVelocity1-=this._average,this._newVelocity2-=this._average,t.velocity.z=this._average+this._newVelocity1*t.bounce.z,i.velocity.z=this._average+this._newVelocity2*i.bounce.z)),!0))}},{key:"overlap",value:function(t,i){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o=arguments[4];if(o=o||e,this._result=!1,this._total=0,Array.isArray(i))for(var h=0,n=i.length;h<n;h++)this.collideHandler(t,i[h],e,s,o,!0);else this.collideHandler(t,i,e,s,o,!0);return this._total>0}},{key:"collide",value:function(t,i){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o=arguments[4];if(o=o||e,this._result=!1,this._total=0,Array.isArray(i))for(var h=0,n=i.length;h<n;h++)this.collideHandler(t,i[h],e,s,o,!1);else this.collideHandler(t,i,e,s,o,!1);return this._total>0}},{key:"collideHandler",value:function(t,i,e,s,o,h){i||t.type!==Phaser.GROUP?t&&i&&(t.type===a.ISOSPRITE?i.type===a.ISOSPRITE?this.collideSpriteVsSprite(t,i,e,s,o,h):i.type===Phaser.GROUP&&this.collideSpriteVsGroup(t,i,e,s,o,h):t.type===Phaser.GROUP&&(i.type===a.ISOSPRITE?this.collideSpriteVsGroup(i,t,e,s,o,h):i.type===Phaser.GROUP&&this.collideGroupVsGroup(t,i,e,s,o,h))):this.collideGroupVsSelf(t,e,s,o,h)}},{key:"collideSpriteVsSprite",value:function(t,i,e,s,o,h){return!(!t.body||!i.body)&&(this.separate(t.body,i.body,s,o,h)&&(e&&e.call(o,t,i),this._total++),!0)}},{key:"collideSpriteVsGroup",value:function(t,i,e,s,o,h){var n,r;if(0!==i.children.size&&t.body)if(t.body.skipTree||this.skipTree)for(n=0,r=i.children.size;n<r;n++){var a=i.children.entries[n];a&&this.collideSpriteVsSprite(t,a,e,s,o,h)}else for(this.octree.clear(),this.octree.reset(this.bounds.x,this.bounds.y,this.bounds.z,this.bounds.widthX,this.bounds.widthY,this.bounds.height,this.maxObjects,this.maxLevels),this.octree.populate(i),this._potentials=this.octree.retrieve(t),n=0,r=this._potentials.length;n<r;n++)this.separate(t.body,this._potentials[n],s,o,h)&&(e&&e.call(o,t,this._potentials[n].sprite),this._total++)}},{key:"collideGroupVsSelf",value:function(t,i,e,s,o){if(0!==t.children.size)for(var h=t.children.size,n=0;n<h;n++)for(var r=n+1;r<=h;r++){var a=t.children.entries,l=a[n],u=a[r];l&&u&&this.collideSpriteVsSprite(l,u,i,e,s,o)}}},{key:"collideGroupVsGroup",value:function(t,i,e,s,o,h){if(0!==t.children.size&&0!==i.children.size)for(var n=0,r=t.children.size;n<r;n++)this.collideSpriteVsGroup(t.children.entries[n],i,e,s,o,h)}},{key:"updateMotion",value:function(t,i){this._velocityDelta=this.computeVelocity(0,t,t.angularVelocity,t.angularAcceleration,t.angularDrag,t.maxAngular)-t.angularVelocity,t.angularVelocity+=this._velocityDelta,t.rotation+=t.angularVelocity*i,t.velocity.x=this.computeVelocity(1,t,t.velocity.x,t.acceleration.x,t.drag.x,t.maxVelocity.x,i),t.velocity.y=this.computeVelocity(2,t,t.velocity.y,t.acceleration.y,t.drag.y,t.maxVelocity.y,i),t.velocity.z=this.computeVelocity(3,t,t.velocity.z,t.acceleration.z,t.drag.z,t.maxVelocity.z,i)}},{key:"update",value:function(t,i){var e=this.bodies.entries,s=e.length,o=void 0;for(o=0;o<s;o++){e[o].enable&&e[o].update(t,i)}}},{key:"postUpdate",value:function(){var t=this.bodies.entries,i=t.length,e=void 0;for(e=0;e<i;e++){var s=t[e];s.enable&&s.postUpdate()}}}]),t}();i.default=y},function(t,i,e){t.exports=e(11)},function(t,i,e){"use strict";var s=function(){function t(t,i){for(var e=0;e<i.length;e++){var s=i[e];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(i,e,s){return e&&t(i.prototype,e),s&&t(i,s),i}}(),o=r(e(3)),h=r(e(2)),n=r(e(4));
/**
 * @author       Lewis Lane <lew@rotates.org>
 * @copyright    2015 Lewis Lane (Rotates.org)
 * @license      {@link http://opensource.org/licenses/MIT|MIT License}
 */function r(t){return t&&t.__esModule?t:{default:t}}var a=function(){function t(i){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,t),this.scene=i,this.systems=i.sys,i.sys.settings.isBooted||i.sys.events.once("boot",this.boot,this),this.projector=new o.default(i,i.isometricType),Phaser.GameObjects.GameObjectFactory.register("isoSprite",(function(t,i,e,s,o){var n=new h.default(this.scene,t,i,e,s,o);return this.systems.displayList.add(n),this.systems.updateList.add(n),n})),Phaser.GameObjects.GameObjectFactory.register("isoParticles",(function(t,i,e){var s=new n.default(this.scene,t,i,e);return this.systems.displayList.add(s),this.systems.updateList.add(s),s}))}return s(t,[{key:"boot",value:function(){}}],[{key:"register",value:function(i){i.register("IsoPlugin",t,"isoPlugin")}}]),t}();a.Cube=e(1),a.IsoSprites=e(2),a.Octree=e(7),a.Particles=e(12),a.Physics=e(13),a.Point3=e(0),a.Projector=e(3),t.exports=a},function(t,i,e){"use strict";var s={IsoZone:e(6),IsoParticleEmitterManager:e(4),IsoParticleEmitter:e(5)};t.exports=s},function(t,i,e){"use strict";var s={Body:e(8),IsoPhysics:e(14),World:e(9)};t.exports=s},function(t,i,e){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var s=function(){function t(t,i){for(var e=0;e<i.length;e++){var s=i[e];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(i,e,s){return e&&t(i.prototype,e),s&&t(i,s),i}}(),o=n(e(0)),h=n(e(9));function n(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(i){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,t),this.scene=i;var e=this.scene.sys.settings.map.isoPlugin;this.projector=this.scene[e].projector,this.world=new h.default(this.scene)}return s(t,[{key:"distanceBetween",value:function(t,i){return this._dx=t.x-i.x,this._dy=t.y-i.y,this._dz=t.z-i.z,Math.sqrt(this._dx*this._dx+this._dy*this._dy+this._dz*this._dz)}},{key:"distanceToXY",value:function(t,i,e){return this._dx=t.x-i,this._dy=t.y-e,Math.sqrt(this._dx*this._dx+this._dy*this._dy)}},{key:"distanceToXYZ",value:function(t,i,e,s){return this._dx=t.x-i,this._dy=t.y-e,this._dz=t.z-s,Math.sqrt(this._dx*this._dx+this._dy*this._dy+this._dz*this._dz)}},{key:"distanceToPointer",value:function(t,i){i=i||this.scene.input.activePointer;var e=this.projector.unproject(i.position,void 0,t.z);return e.z=t.z,this.anglesToXYZ(t,e.x,e.y,e.z).r}},{key:"anglesToXYZ",value:function(t,i,e,s){var o=this.distanceToXYZ(t,i,e,s);return{r:o,theta:Math.atan2(e-t.y,i-t.x),phi:Math.acos((s-t.z)/o)}}},{key:"angleToPointer",value:function(t,i){i=i||this.scene.input.activePointer;var e=this.projector.unproject(i.position,void 0,t.z);return e.z=t.z,this.anglesToXYZ(t,e.x,e.y,e.z).theta}},{key:"velocityFromAngles",value:function(t,i,e){return void 0===i&&(i=Math.sin(Math.PI/2)),void 0===e&&(e=60),new o.default(Math.cos(t)*Math.sin(i)*e,Math.sin(t)*Math.sin(i)*e,Math.cos(i)*e)}},{key:"accelerateToXYZ",value:function(t,i,e,s,o,h,n,r){void 0===o&&(o=60),void 0===h&&(h=500),void 0===n&&(n=500),void 0===r&&(r=500);var a=this.anglesToXYZ(t.body,i,e,s),l=this.velocityFromAngles(a.theta,a.phi,o);return t.body.acceleration.setTo(l.x,l.y,l.z),t.body.maxVelocity.setTo(h,n,r),a.theta}},{key:"moveToXYZ",value:function(t,i,e,s,o,h){void 0===o&&(o=60),void 0===h&&(h=0),h>0&&(o=this.distanceToXYZ(t.body,i,e,s)/(h/1e3));var n=this.anglesToXYZ(t.body,i,e,s),r=this.velocityFromAngles(n.theta,n.phi,o);return t.body.velocity.copyFrom(r),n.theta}},{key:"moveToObject",value:function(t,i,e,s){return this.moveToXYZ(t,i.x,i.y,i.z,e,s)}},{key:"moveToPointer",value:function(t,i,e,s){e=e||this.game.input.activePointer;var o=this.game.iso.unproject(e.position,void 0,t.body.z);o.z=t.body.z,void 0===i&&(i=60),void 0===s&&(s=0),s>0&&(i=this.distanceToXYZ(t.body,o.x,o.y,o.z)/(s/1e3));var h=this.anglesToXYZ(t.body,o.x,o.y,o.z),n=this.velocityFromAngles(h.theta,h.phi,i);return t.body.velocity.x=n.x,t.body.velocity.y=n.y,h.theta}},{key:"boot",value:function(){var t=this.scene.sys.events;t.on("update",this.world.update,this.world),t.on("postupdate",this.world.postUpdate,this.world)}}],[{key:"register",value:function(i){i.register("IsoPhysics",t,"isoPhysics")}}]),t}();i.default=r}]);